<!DOCTYPE html>
<html>
<head>

  <!-- adding in modules used in this script  -->
  <script src="https://unpkg.com/jspsych@7.3.4" type="text/javascript"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-html-choice@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/extension-mouse-tracking@1.0.3"></script>
  <script src="https://unpkg.com/@jspsych/extension-mouse-tracking@1.0.3"></script>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
  <script src="stimuli.js"></script>
  <script src="parameters.js"></script>
  <script src="functions.js"></script>

  <!-- style sheets -->
  <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css"/>
  <link rel="stylesheet" href="style.css"/>

</head>
<body></body>
<script>

/* 
  Body of the Script
  Do NOT edit below this line
  See jspsyh website (https://www.jspsych.org/) for more information before editing below this line
*/

var jsPsych = initJsPsych({
  on_finish: function() {

    var mouse_tracking_data = jsPsych.data.get().select('mouse_tracking_data').values;
    var trace = mouse_tracking_data.map((j, idx) => {
      var x = j.map((k) => k.x)
      x = x.map((t) => t - x[0])
      var y = j.map((k) => k.y)
      y = y.map((t) => (t - y[0]) * -1 )
      return {x:x, y:y, type: 'scatter', name: `trial ${idx+1}`}
    })

    content = document.getElementById('jspsych-content');
    Plotly.newPlot(content, trace);    

  },
  extensions: [
    { type: jsPsychExtensionMouseTracking, params: {minimum_sample_time: 0} }
  ]
});

var instruct = {
  type: jsPsychHtmlButtonResponse,
  stimulus: construct_both,
  choices: ['Start'],
  button_html: construct_button,
  prompt: construct_prompt,
  data: {
    task: 'instructions'
  }
};

var trial = {
      type: jsPsychHtmlChoice,
      html_array: [
        construct_stim_one,
        construct_stim_two,
      ],
      trial_duration: trial_duration,
      values: [null, null],
      response_ends_trial: response_ends_trial,
      time_after_response: time_after_response,
      extensions: [
        {type: jsPsychExtensionMouseTracking, params: {targets: []}}
      ],
      data: {
        task: 'trial'
      }
};

mouse_track_procedure = {
  timeline: [instruct, trial],
  timeline_variables: stim_list,
}

jsPsych.run([mouse_track_procedure]);

</script>

</html>
